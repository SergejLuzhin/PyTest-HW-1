from selenium.webdriver.common.by import By
from utils.test_utils import *


class WikipediaPage:
    """Класс представляет собой Page Object страницы статьи на сайте Wikipedia.

        Назначение:
            Предоставляет методы для проверки заголовка страницы и сведений
            об авторе в информационной таблице статьи.

        Автор: Сергей Лужин
        """

    def __init__(self, webdriver):
        """Инициализирует объект страницы Wikipedia.

                Назначение:
                    Сохраняет экземпляр WebDriver для дальнейшего взаимодействия
                    с открытой страницей Wikipedia.

                Параметры:
                    webdriver: Экземпляр Selenium WebDriver, управляющий браузером.

                Автор: Сергей Лужин
                """
        self.webdriver = webdriver

    def __get_author_in_table(self) -> str:
        """Возвращает имя автора из информационной таблицы статьи.

                Назначение:
                    Находит в таблице характеристик строки со столбцом «Автор»
                    и извлекает текст ссылки с именем автора.

                Возвращает:
                    str: Имя автора, указанное в колонке «Автор» на странице.

                Автор: Сергей Лужин
                """
        return self.webdriver.find_element(By.XPATH, "//tr[th[contains(. , 'Автор')]]//span/a").text

    def check_title(self, title: str):
        """Проверяет, что заголовок вкладки страницы соответсвует ожидаемому топику.

                Назначение:
                    Убеждается, что в заголовке вкладки браузера присутствует
                    ожидаемое слово/фраза. В случае несоответствия вызывает падение теста
                    с поясняющим сообщением. Делает скриншот страницы для Allure-отчёта.

                Параметры:
                    title (str): Ожидаемое слово или фраза, которые должны
                        присутствовать в заголовке страницы.

                Автор: Сергей Лужин
                """
        with allure.step(f"Проверяем, что: В заголовке страницы содержится слово {title}"):
            allure_screenshot(self.webdriver, "Открытая страница")
            assert title.lower() in self.webdriver.title.lower(), f"Заголовок вкладки не содержит '{title}'"

    def check_author(self, checked_author: str):
        """Проверяет, что в колонке «Автор» указан ожидаемый автор.

                Назначение:
                    Сравнивает значение в столбце «Автор» информационной таблицы статьи
                    с ожидаемым значением. При несовпадении вызывает падение теста
                    с описанием ошибки. Делает скриншот текущей страницы для Allure-отчёта.

                Параметры:
                    checked_author (str): Ожидаемое имя автора, которое должно быть
                        указано в соответствующей строке таблицы.

                Автор: Сергей Лужин
                """
        with allure.step(f"Проверяем, что: Колонка со сведениями 'Автор' содержит '{checked_author}' "):
            allure_screenshot(self.webdriver, "Открытая страница")
            assert self.__get_author_in_table() == checked_author